<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Times New Roman', Times, serif;
      margin: 0;
      overflow: auto;
    }
    #background {
      font-family: 'Times New Roman', Times, serif;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color:#800000;
      z-index: -1;
    }
    .questionnaire-container {
      font-family: 'Times New Roman', Times, serif;
      display: none;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px;
      background-color: white;
      z-index: 1;
      }
      .redText {
        color: red
      }
      .blackText {
        color: black
      }
      h1{
        font-family: 'Times New Roman', Times, serif;
        text-decoration: underline;
        text-align: center;
      }
      text{
        font-family: 'Times New Roman', Times, serif;
        text-align: center;
        color: red;
      }
  </style>
</head>
<body onload="showQuestionnaire()">
  <div id="background"></div>
  <div id="questionnaireContainer" class="questionnaire-container"></div>

  <script>
    var order = {"foundHomilyCompelling": '0',"understandingOfMessagePreached": '0',
    "agreementWithHomilyMessage": '0',"DidHomilyChangeYourThinking": '0',"DidHomilyChangeYourFeelings": '0',
    'DirectionOfHomilyFeelingChange': '0','receptivenessToHomily': '0','engagedDuringHomily': '0',
    "effectiveMessageCommunication": '0',"AchievementOfSpeakersGoals": '0',"messageMeaning": '0'};
    
    var saveOrder = ["foundHomilyCompelling","understandingOfMessagePreached","agreementWithHomilyMessage",
    "DidHomilyChangeYourThinking","DidHomilyChangeYourFeelings","DirectionOfHomilyFeelingChange",
    "receptivenessToHomily","engagedDuringHomily","effectiveMessageCommunication","AchievementOfSpeakersGoals",
    "engaging","clarity","organization","contextual","persuasive","theology","accessibility","communication","naturalness",
    "grammar","rhetoric","assembly","volume","rate","pitch","variety","enunciation","pronunciation","messageMeaning",
    "generalAdditionalComments","organizationAdditionalComments","languageAdditionalComments",
    "voiceAdditionalComments","otherComments"];

    // // JavaScript code to check the user number and redirect if it's missing
    document.addEventListener('DOMContentLoaded', function() {
        // Retrieve the user number from sessionStorage
        var userNumber = sessionStorage.getItem('userId');

        // Check if the user number is not found
        if (!userNumber) {
            // Redirect to the 'enter_user_number.html' page
            window.location.href = 'enter_user_number.html';
        }
    });

    const extension = '.mp3';

    sessionStorage.setItem('userType', 'expert');
    sessionStorage.setItem('experimentSource', 'na');
    sessionStorage.setItem('experimentType', 'audio');


    // this block of code generates and displays the form for the user
    // ----------------------------------------------------------------
    // ----------------------------------------------------------------
    // ----------------------------------------------------------------
    function showQuestionnaire() {
      const questionnaireContainer = document.getElementById('questionnaireContainer');
      questionnaireContainer.innerHTML = generateQuestionnaireHTML();

      // Display the questionnaire
      questionnaireContainer.style.display = 'block';
    }


    function generateQuestionnaireHTML() {
      // You can customize the questionnaire HTML generation based on your requirements
        var beginning = `
        <h1>Instructions </h1>
        <p>Please respond to the following questions about the homily you were just shown.
          You must respond to all of the required questions before submitting the form.
          Any unrequired question will be tagged as "optional". 
          Some questions will ask you to rate a particular feature of the homily on a scale from 1 to 6.
          Other questions will require a text entry with a minimum word count. 
          </p>
        
        <h1> Questions </h1>`;

        var question1 = `<!-- Compelling-ness -->
        <label for = "foundHomilyCompelling">
        <p><b>How compelling did you find this homily?</b></p>
        </label>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="1" onclick="uncheckOthers('foundHomilyCompelling', this)"> Not compelling (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="2" onclick="uncheckOthers('foundHomilyCompelling', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="3" onclick="uncheckOthers('foundHomilyCompelling', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="4" onclick="uncheckOthers('foundHomilyCompelling', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="5" onclick="uncheckOthers('foundHomilyCompelling', this)"> (5)
        </label> 
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="6" onclick="uncheckOthers('foundHomilyCompelling', this)"> Very compelling (6)
        </label> 
        <br> <br>`;
        

        var question2 = `<!-- Understanding-->
        <label for = "understandingOfMessagePreached">
        <p><b>Did you understand the message being preached?</b></p>
        </label>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="1" onclick="uncheckOthers('understandingOfMessagePreached', this)"> Did not understand it (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="2" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="3" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="4" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="5" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (5)
        </label> 
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="6" onclick="uncheckOthers('understandingOfMessagePreached', this)"> Understood it very well (6)
        </label> 
        <br> <br>`;

        var question3 = `<label for="messageMeaning"><p><b>What did you understand the message of the homily to be? (25 word minimum): </b></p></label>
        <textarea id="messageMeaning" name="messageMeaning" rows="4" cols="50"></textarea>`;

        var question4 = `<!-- Agreement-->
        <label for = "agreementWithHomilyMessage">
        <p><b>Do you agree with the homily's message?</b></p>
        </label>
        <label>
            <input type="checkbox" name="agreementWithHomilyMessage" value="1" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="2" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "agreementWithHomilyMessage" value="3" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="4" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="5" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="6" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> Yes (6)
        </label>
        <br> <br>`;

        var question5 = `<!-- Change in Thinking-->
        <label for = "DidHomilyChangeYourThinking">
        <p><b>Did the homily change your thinking about this message?</b></p>
        </label>
        <label>
            <input type="checkbox" name="DidHomilyChangeYourThinking" value="1" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="2" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DidHomilyChangeYourThinking" value="3" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="4" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="5" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="6" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> Yes (6)
        </label>
        <br> <br>`;

        // <!-- Accepting of the message
        // <p>6. Were you more or less accepting of the message being preached after watching the homily?</p>
        // <label>
        //     <input type="checkbox" name="accepting" value="Much less accepting" onclick="uncheckOthers('accepting', this)"> Much less accepting
        // </label>
        // <br>
        // <label>
        //   <input type="checkbox" name="accepting" value="Somewhat less accepting" onclick="uncheckOthers('accepting', this)"> Somewhat less accepting
        // </label>
        // <br>
        // <label>
        //   <input type="checkbox" name= "accepting" value="Just as accepting as I was before watching the homily" onclick="uncheckOthers('accepting', this)"> Just as accepting as I was before watching the homily
        // </label>
        // <br>
        // <label>
        //   <input type="checkbox" name="accepting" value="Somewhat more accepting" onclick="uncheckOthers('accepting', this)"> Somewhat more accepting
        // </label>
        // <br>
        // <label>
        //   <input type="checkbox" name="accepting" value="Much more accepting" onclick="uncheckOthers('accepting', this)"> Much more accepting
        // </label> -->


        var question6 = `<!-- Change in Feelings -->
        <label for = "DidHomilyChangeYourFeelings">
        <p><b>Did the homily change your feelings in any way?</b></p>
        </label>
        <label>
            <input type="checkbox" name="DidHomilyChangeYourFeelings" value="1" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="2" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DidHomilyChangeYourFeelings" value="3" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="4" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="5" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="6" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> Yes (6)
        </label>
        <br> <br>`;

        var question7 = `<!-- Direction of feeling change-->
        <label for = "DirectionOfHomilyFeelingChange">
        <p><b>Was the homily's effect on your feelings positive or negative?</b></p>
        </label>
        <label>
            <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="1" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> Negative (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="2" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DirectionOfHomilyFeelingChange" value="3" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="4" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="5" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="6" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> Positive (6)
        </label>
        <br> <br>`;

        var question8 = `<!-- receptiveness-->
        <label for = "receptivenessToHomily">
        <p><b>Do you believe the congregation would have been receptive to this homily?</b></p>
        </label>
        <label>
            <input type="checkbox" name="receptivenessToHomily" value="1" onclick="uncheckOthers('receptivenessToHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="receptivenessToHomily" value="2" onclick="uncheckOthers('receptivenessToHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "receptivenessToHomily" value="3" onclick="uncheckOthers('receptivenessToHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="receptivenessToHomily" value="4" onclick="uncheckOthers('receptivenessToHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="receptivenessToHomily" value="5" onclick="uncheckOthers('receptivenessToHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="receptivenessToHomily" value="6" onclick="uncheckOthers('receptivenessToHomily', this)"> Yes (6)
        </label>`;


        var question9 = `<!-- Engagement-->
        <label for = "engagedDuringHomily">
        <p><b>Did you feel engaged while listening the homily?</b></p>
        </label>
        <label>
            <input type="checkbox" name="engagedDuringHomily" value="1" onclick="uncheckOthers('engagedDuringHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="2" onclick="uncheckOthers('engagedDuringHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "engagedDuringHomily" value="3" onclick="uncheckOthers('engagedDuringHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="4" onclick="uncheckOthers('engagedDuringHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="5" onclick="uncheckOthers('engagedDuringHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="6" onclick="uncheckOthers('engagedDuringHomily', this)"> Yes (6)
        </label>
        <br> <br>`

        var question10 = `<!-- Effectiveness -->
        <label for = "effectiveMessageCommunication">
        <p><b>Was the message effectively communicated?</b></p>
        </label>
        <label>
            <input type="checkbox" name="effectiveMessageCommunication" value="1" onclick="uncheckOthers('effectiveMessageCommunication', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="2" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "effectiveMessageCommunication" value="3" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="4" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="5" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="6" onclick="uncheckOthers('effectiveMessageCommunication', this)"> Yes (6)
        </label>
        <br> <br>`

        var question11 = `<!-- Achievement of speaker's goals-->
        <label for = "AchievementOfSpeakersGoals">
        <p><b>Do you feel that the speaker achieved their goals in this homily?</b></p>
        </label>
        <label>
            <input type="checkbox" name="AchievementOfSpeakersGoals" value="1" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AchievementOfSpeakersGoals" value="2" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "AchievementOfSpeakersGoals" value="3" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AchievementOfSpeakersGoals" value="4" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AchievementOfSpeakersGoals" value="5" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AchievementOfSpeakersGoals" value="6" onclick="uncheckOthers('AchievementOfSpeakersGoals', this)"> Yes (6)
        </label>`;


        // <!--
        // // <br>
        // // <br>
        // // <label for="freeform">12. How do you believe that the audience received the message of this Homily? How receptive do you anticipate they would have been to its message? (25 word minimum): </label>
        // // <br>
        // // <textarea id="receptiveness" name="freeform" rows="4" cols="50"></textarea>
        // -->


        var question12 = `<br>
        <br>
        <label for="freeform">Additional Comments (optional):</label>
        <br>
        <textarea id="generalAdditionalComments" name="freeform" rows="4" cols="50"></textarea>`;

        var end = `<h1>Organization and Content</h1>

        <label for = "engaging">
        <p><b>Engaging Introduction</b></p>
        </label>
        <label>
            <input type="checkbox" name="engaging" value="1" onclick="uncheckOthers('engaging', this)"> Worst (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engaging" value="2" onclick="uncheckOthers('engaging', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "engaging" value="3" onclick="uncheckOthers('engaging', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engaging" value="4" onclick="uncheckOthers('engaging', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engaging" value="5" onclick="uncheckOthers('engaging', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engaging" value="6" onclick="uncheckOthers('engaging', this)"> Best (6)
        </label>

        <label for = "clarity">
        <p><b>Main Points Clearly Stated</b></p>
        </label>
        <label>
            <input type="checkbox" name="clarity" value="1" onclick="uncheckOthers('clarity', this)"> Worst (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="clarity" value="2" onclick="uncheckOthers('clarity', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "clarity" value="3" onclick="uncheckOthers('clarity', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="clarity" value="4" onclick="uncheckOthers('clarity', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="clarity" value="5" onclick="uncheckOthers('clarity', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="clarity" value="6" onclick="uncheckOthers('clarity', this)"> Best (6)
        </label>

        <label for = "organization">
        <p><b>Well Organized</b></p>
        </label>
        <label>
            <input type="checkbox" name="organization" value="1" onclick="uncheckOthers('organization', this)"> Worst (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="organization" value="2" onclick="uncheckOthers('organization', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "organization" value="3" onclick="uncheckOthers('organization', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="organization" value="4" onclick="uncheckOthers('organization', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="organization" value="5" onclick="uncheckOthers('organization', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="organization" value="6" onclick="uncheckOthers('organization', this)"> Best (6)
        </label>

        <label for = "contextual">
        <p><b>Appropriately Contextual</b></p>
        </label>
        <label>
            <input type="checkbox" name="contextual" value="1" onclick="uncheckOthers('contextual', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="contextual" value="2" onclick="uncheckOthers('contextual', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "contextual" value="3" onclick="uncheckOthers('contextual', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="contextual" value="4" onclick="uncheckOthers('contextual', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="contextual" value="5" onclick="uncheckOthers('contextual', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="contextual" value="6" onclick="uncheckOthers('contextual', this)"> Best (6)
        </label>

        <label for = "persuasive">
        <p><b>Engaging/Persuasive</b></p>
        </label>
        <label>
            <input type="checkbox" name="persuasive" value="1" onclick="uncheckOthers('persuasive', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="persuasive" value="2" onclick="uncheckOthers('persuasive', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "persuasive" value="3" onclick="uncheckOthers('persuasive', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="persuasive" value="4" onclick="uncheckOthers('persuasive', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="persuasive" value="5" onclick="uncheckOthers('persuasive', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="persuasive" value="6" onclick="uncheckOthers('persuasive', this)"> Best (6)
        </label>

        <label for = "theology">
        <p><b>Theological/Liturgical Literacy</b></p>
        </label>
        <label>
            <input type="checkbox" name="theology" value="1" onclick="uncheckOthers('theology', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="theology" value="2" onclick="uncheckOthers('theology', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "theology" value="3" onclick="uncheckOthers('theology', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="theology" value="4" onclick="uncheckOthers('theology', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="theology" value="5" onclick="uncheckOthers('theology', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="theology" value="6" onclick="uncheckOthers('theology', this)"> Best (6)
        </label>

        <label for = "accessibility">
        <p><b>Pastoral Accessibility</b></p>
        </label>
        <label>
            <input type="checkbox" name="accessibility" value="1" onclick="uncheckOthers('accessibility', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="accessibility" value="2" onclick="uncheckOthers('accessibility', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "accessibility" value="3" onclick="uncheckOthers('accessibility', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="accessibility" value="4" onclick="uncheckOthers('accessibility', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="accessibility" value="5" onclick="uncheckOthers('accessibility', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="accessibility" value="6" onclick="uncheckOthers('accessibility', this)"> Best (6)
        </label>

        <br>
        <br>
        <label for="freeform">Additional Comments (optional):</label>
        <br>

        <textarea id="organizationAdditionalComments" name="freeform" rows="4" cols="50"></textarea>




        
        <h1>Language</h1>

        <label for = "communication">
        <p><b>Appropriate to Oral Communication</b></p>
        </label>
        <label>
            <input type="checkbox" name="communication" value="1" onclick="uncheckOthers('communication', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="communication" value="2" onclick="uncheckOthers('communication', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "communication" value="3" onclick="uncheckOthers('communication', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="communication" value="4" onclick="uncheckOthers('communication', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="communication" value="5" onclick="uncheckOthers('communication', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="communication" value="6" onclick="uncheckOthers('communication', this)"> Best (6)
        </label>

        <label for = "naturalness">
        <p><b>Naturalness</b></p>
        </label>
        <label>
            <input type="checkbox" name="naturalness" value="1" onclick="uncheckOthers('naturalness', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="naturalness" value="2" onclick="uncheckOthers('naturalness', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "naturalness" value="3" onclick="uncheckOthers('naturalness', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="naturalness" value="4" onclick="uncheckOthers('naturalness', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="naturalness" value="5" onclick="uncheckOthers('naturalness', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="naturalness" value="6" onclick="uncheckOthers('naturalness', this)"> Best (6)
        </label>

        <label for = "grammar">
        <p><b>Grammar</b></p>
        </label>
        <label>
            <input type="checkbox" name="grammar" value="1" onclick="uncheckOthers('grammar', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="grammar" value="2" onclick="uncheckOthers('grammar', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "grammar" value="3" onclick="uncheckOthers('grammar', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="grammar" value="4" onclick="uncheckOthers('grammar', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="grammar" value="5" onclick="uncheckOthers('grammar', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="grammar" value="6" onclick="uncheckOthers('grammar', this)"> Best (6)
        </label>

        <label for = "rhetoric">
        <p><b>Rhetorical/Poetic Richness</b></p>
        </label>
        <label>
            <input type="checkbox" name="rhetoric" value="1" onclick="uncheckOthers('rhetoric', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="rhetoric" value="2" onclick="uncheckOthers('rhetoric', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "rhetoric" value="3" onclick="uncheckOthers('rhetoric', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="rhetoric" value="4" onclick="uncheckOthers('rhetoric', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="rhetoric" value="5" onclick="uncheckOthers('rhetoric', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="rhetoric" value="6" onclick="uncheckOthers('rhetoric', this)"> Best (6)
        </label>

        <label for = "assembly">
        <p><b>Accessibility to Assembly</b></p>
        </label>
        <label>
            <input type="checkbox" name="assembly" value="1" onclick="uncheckOthers('assembly', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="assembly" value="2" onclick="uncheckOthers('assembly', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "assembly" value="3" onclick="uncheckOthers('assembly', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="assembly" value="4" onclick="uncheckOthers('assembly', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="assembly" value="5" onclick="uncheckOthers('assembly', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="assembly" value="6" onclick="uncheckOthers('assembly', this)"> Best (6)
        </label>

        <br>
        <br>
        <label for="freeform">Additional Comments (optional):</label>
        <br>

        <textarea id="languageAdditionalComments" name="freeform" rows="4" cols="50"></textarea>




        <h1>Voice</h1>

        <label for = "volume">
        <p><b>Volume</b></p>
        </label>
        <label>
            <input type="checkbox" name="volume" value="1" onclick="uncheckOthers('volume', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="volume" value="2" onclick="uncheckOthers('volume', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "volume" value="3" onclick="uncheckOthers('volume', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="volume" value="4" onclick="uncheckOthers('volume', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="volume" value="5" onclick="uncheckOthers('volume', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="volume" value="6" onclick="uncheckOthers('volume', this)"> Best (6)
        </label>

        <label for = "rate">
        <p><b>Rate of Speech/Pacing</b></p>
        </label>
        <label>
            <input type="checkbox" name="rate" value="1" onclick="uncheckOthers('rate', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="rate" value="2" onclick="uncheckOthers('rate', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "rate" value="3" onclick="uncheckOthers('rate', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="rate" value="4" onclick="uncheckOthers('rate', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="rate" value="5" onclick="uncheckOthers('rate', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="rate" value="6" onclick="uncheckOthers('rate', this)"> Best (6)
        </label>

        <label for = "pitch">
        <p><b>Pitch</b></p>
        </label>
        <label>
            <input type="checkbox" name="pitch" value="1" onclick="uncheckOthers('pitch', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="pitch" value="2" onclick="uncheckOthers('pitch', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "pitch" value="3" onclick="uncheckOthers('pitch', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="pitch" value="4" onclick="uncheckOthers('pitch', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="pitch" value="5" onclick="uncheckOthers('pitch', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="pitch" value="6" onclick="uncheckOthers('pitch', this)"> Best (6)
        </label>

        <label for = "variety">
        <p><b>Vocal Variety</b></p>
        </label>
        <label>
            <input type="checkbox" name="variety" value="1" onclick="uncheckOthers('variety', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="variety" value="2" onclick="uncheckOthers('variety', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "variety" value="3" onclick="uncheckOthers('variety', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="variety" value="4" onclick="uncheckOthers('variety', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="variety" value="5" onclick="uncheckOthers('variety', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="variety" value="6" onclick="uncheckOthers('variety', this)"> Best (6)
        </label>

        <label for = "enunciation">
        <p><b>Enunciation</b></p>
        </label>
        <label>
            <input type="checkbox" name="enunciation" value="1" onclick="uncheckOthers('enunciation', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="enunciation" value="2" onclick="uncheckOthers('enunciation', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "enunciation" value="3" onclick="uncheckOthers('enunciation', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="enunciation" value="4" onclick="uncheckOthers('enunciation', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="enunciation" value="5" onclick="uncheckOthers('enunciation', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="enunciation" value="6" onclick="uncheckOthers('enunciation', this)"> Best (6)
        </label>

        <label for = "pronunciation">
        <p><b>Pronunciation</b></p>
        </label>
        <label>
            <input type="checkbox" name="pronunciation" value="1" onclick="uncheckOthers('pronunciation', this)"> Worst (1)
        </label><br>
        <label>
          <input type="checkbox" name="pronunciation" value="2" onclick="uncheckOthers('pronunciation', this)"> (2)
        </label><br>
        <label>
          <input type="checkbox" name= "pronunciation" value="3" onclick="uncheckOthers('pronunciation', this)"> (3)
        </label><br>
        <label>
          <input type="checkbox" name="pronunciation" value="4" onclick="uncheckOthers('pronunciation', this)"> (4)
        </label><br>
        <label>
          <input type="checkbox" name="pronunciation" value="5" onclick="uncheckOthers('pronunciation', this)"> (5)
        </label><br>
        <label>
          <input type="checkbox" name="pronunciation" value="6" onclick="uncheckOthers('pronunciation', this)"> Best (6)
        </label>
        <br>
        <br>
        <label for="freeform">Additional Comments (optional):</label>
        <br>

        <textarea id="voiceAdditionalComments" name="freeform" rows="4" cols="50"></textarea>

        </label>
        <br>
        <br>
        <label for="freeform">Other Valuable Commendations/Reccomendations or technical issues you encountered (optional):</label>
        <br>

        <textarea id="otherComments" name="freeform" rows="4" cols="50"></textarea>

        <br>
        <br>
        <center>
          <text id = 'errorMessage'></text>
        </center>

        <br>
        <center>
          <button onclick="submitForm()">Submit</button>
        </center>
        <br>`;

      // list of the questions we ask (if you add more questions, then follow the format above and add to this list)
      var questionTuples = [["foundHomilyCompelling", question1], ["understandingOfMessagePreached", question2],
       ["messageMeaning", question3], ["agreementWithHomilyMessage", question4], 
       ["DidHomilyChangeYourThinking", question5], ['DidHomilyChangeYourFeelings', question6], 
       ['DirectionOfHomilyFeelingChange', question7], ['receptivenessToHomily', question8], 
       ["engagedDuringHomily", question9], ["effectiveMessageCommunication", question10], 
       ["AchievementOfSpeakersGoals", question11]];
      for (let i = questionTuples.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); // Generate random index from 0 to i
        [questionTuples[i], questionTuples[j]] = [questionTuples[j], questionTuples[i]]; // Swap elements at i and j indices
      }

      var questions = [];
      for (let i = 0; i <= questionTuples.length - 1; i++) {
        questions.push(questionTuples[i][1]);
        questionTuples[i].push(String(i + 1));
      }
      for (let i = 0; i <= questionTuples.length - 1; i++) {
        order[questionTuples[i][0]] = questionTuples[i][2];
      }
      
      finalHTML = beginning + questions.join('') + question12 + end;
      return finalHTML
    }
    // ----------------------------------------------------------------
    // ----------------------------------------------------------------
    // ----------------------------------------------------------------



  
    // this block of code checks if user has completed the form and if so,
    // sends that data to the server to be stored as a csv file. 
    // If not, an error message is displayed.
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------

    // submits the form and send data if complete, otherwise gives error message
    async function submitForm() {

    // check to see if the user properly filled out the questionnaire
    const isValid = await validateForm();

    // if the user did not properly fill out the questionnaire, then...
    if (!isValid) {

      // retrieve the HTMl element that holds the error message
      const errorMessage = document.getElementById('errorMessage');

      // add an error message to the bottom of the screen
      errorMessage.textContent = 'You must respond to all questions and meet all minimum required word counts';
      
      // remove the error message after 3 seconds
      setTimeout(function() {
        errorMessage.textContent = '';
      }, 3000);
    }
    // if the user properly responded to the questionnaire
    else {      
      
      // collect the header and user responses so we can save on the server
      const header = await getHeader();
      const data = await getData();

      // send the questionnaire responses to the server
      await sendResults(header, data);

      // send the order in which the questions were presented to the server
      await sendOrder(header, order);

      // update the total count of the times the homily has been viewed for this condition
      await updateHomilyCount();

      // check if the user has completed all of the homilies
      const allHomiliesCompleted = await checkHomiliesCompleted();

      // if the user has not completed their required number of homilies, then send
      // them to the pre-homily wait screen so that they will see another homily
      if (!allHomiliesCompleted) {
        window.location.href = 'new_homily_wait_screen.html';
      }
      // if the user has watched the required number of homilies, then...
      else {
        window.location.href = 'preaching_experience.html';
      }
    }
    }


    // validates that the user answered all questions
    async function validateForm() {

    // collect all of the checkboxes in the document
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    // variable reflecting if the user has properly responded to all of the questions
    // (set to false if we discover the user has not properly responded)
    let valid = true;

    // dictionary that helps us group checkboxes with the question they are a part of
    let name_dict = {};

    // variables to store names of answered and unanswered questions
    // (necessary for highlighting unanswered questions red)
    let unanswered = [];
    let answered = [];

    // extract the user's response to the 'messageMeaning' checkbox to ensure they 
    // have met the minimum required word count
    const responseHomilyMessage = document.getElementById("messageMeaning").value;

    // if the wordcount is below 25 (minimum wordcount), then...
    if (wordCount(responseHomilyMessage) < 25){
      
      // add the textbox to the list of unanswered questions
      unanswered.push('messageMeaning');

      // set valid to false to indicate that the user has not properly responded to the questionnaire
      valid = false;
    }
    // if the user has met the minimum required word count, then... 
    else {

      // add the messageMeaning textbox to the list of answered questions
      answered.push('messageMeaning');
    }

    // collect all checkboxes of a given name into a list
    for (let checkbox of checkboxes) {

      // extract the name of the question that the checkbox is a part of
      const name = checkbox.name;

      // try adding the checkbox to the list of checkboxes that are a part of that question
      try {
        name_dict[name].push(checkbox);
      }
      // if the list does not exist yet, then create the list and add the checkbox to it 
      catch (error) {
        name_dict[name] = [checkbox];
      }
    }
      
    // iterate over all of the questions/associated checkboxes
    for (const [name, QuestionCheckboxes] of Object.entries(name_dict)) {

      // initialize a variable to track if the user has checked at least on of the checkboxes in the question
      // (initially set to false, update to true if we find a checkbox in the question that has been checked)
      let responded = false;

      // iterate over the checkboxes in the question
      for (let checkbox of QuestionCheckboxes) {

        // if we find a checkbox that has been checked, then set responded to true
        if (checkbox.checked) {
          responded = true;
        }
      }

      // if the user has not checked any checkbox for this question, then...
      if (!responded) {

        // add the question's name to the list of unanswered questions
        unanswered.push(name);

        // set valid to false to indicate that the user has not properly responded to the questionnaire
        valid = false;
      } 
      // if the user has checked at least one of the checkboxes for this question, then
      //  add the question to the list of answered questions
      else {
        answered.push(name);
      }
    }

    // Highlight the unanswered questions in red and the answered questions in black
    await colorAnsweredAndUnanswered(answered, unanswered);

    // return whether or not the user has responded to the questionnaire properly
    return valid;
    }

    // highlights unanswered questions in red and answered questions in black
    async function colorAnsweredAndUnanswered(answered, unanswered) {

    // color all of the unanswered questions in red
    for (let unansweredQuestion of unanswered) {

      // handle the messageMeaning textbox
      if (unansweredQuestion == 'messageMeaning') {

        // extract the prompt HTML for the messageMeaning textbox
        let questionText = document.querySelector(`label[for="${unansweredQuestion}"]`).querySelector('p');

        // remove black coloring and add red highlighting
        questionText.classList.remove('blackText');
        questionText.classList.add('redText');

        // skip the remainder of the code
        continue;
      } 
      
      // extract the question text for each unanswered set of checkboxes
      const questionText = document.querySelector(`label[for="${unansweredQuestion}"]`).querySelector('p');

      // remove black coloring and add red highlighting
      questionText.classList.remove('blackText');
      questionText.classList.add('redText');

      // collect all of the unanswered checkboxes
      const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${unansweredQuestion}"]`);

      // remove black coloring and add red highlighting for each checkbox from an unanswered question
      for (checkbox of checkboxes) {
        checkbox.closest('label').classList.remove('blackText');
        checkbox.closest('label').classList.add('redText');
      }
    }

    // color all of the answered questions in black
    for (let answeredQuestion of answered) {

      // handle message meaning text box logic separately
      if (answeredQuestion == 'messageMeaning') {

        // extract question text HTML element
        let questionText = document.querySelector(`label[for="${answeredQuestion}"]`).querySelector('p');

        // remove red highlighting and add black coloring
        questionText.classList.remove('redText');
        questionText.classList.add('blackText');

        // skip remainder of the code
        continue;
      } 
      
      // Extract the question text for each answered checkbox question
      const questionText = document.querySelector(`label[for="${answeredQuestion}"]`).querySelector('p');

      // remove red highlighting and add black coloring 
      questionText.classList.remove('redText');
      questionText.classList.add('blackText');

      // extract all checkboxes for the answered question
      const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${answeredQuestion}"]`);

      // for each checkbox, remove red highlighting and add black coloring
      for (let checkbox of checkboxes) {
        checkbox.closest('label').classList.remove('redText');
        checkbox.closest('label').classList.add('blackText');
      }
    }
    }

    // returns the word count of a string
    function wordCount(string) {

    // split text entry into a list for each space 
    const words = string.split(" ");

    // initialize wordcount variable to 0
    var wordcount = 0;

    // iterate over each of the words in the string
    for (let word of words) {

      // If the word isn't just a space, then increment the wordcount variable by 1
      if (!word == ' ') {
        wordcount += 1;
      }
    }

    // return the word count of the text entry
    return wordcount;
    }

    // updates the total homily count on the server
    async function updateHomilyCount() {

    // variables relating to user info
    const userType = sessionStorage.getItem('userType');
    const experimentSource = sessionStorage.getItem('experimentSource');
    const experimentType = sessionStorage.getItem('experimentType');
    const homilyPath = sessionStorage.getItem('homilyId');

    // extract the homily number so we can create the file name of the behavior file we store on the server
    // Split the string on the backslash
    const parts = homilyPath.split("\\");

    // Get the last element from the array
    const homilyName = parts[parts.length - 1];

    // Remove the '.mp3' part and get the number
    const homilyId = homilyName.replace(extension, "");

    // url for route that updates the count of homilies used for the given condition
    const url = `/api/updateHomilyCount`;

    // try sending sign in data to server, keep trying until we get an "ok" response (response code in the 200s range)
    const maxRetries = 3;
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {

        // AJAX request to the server to store consent info
        const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({
              'homilyId' : homilyId, 
              'userType' : userType,
              'experimentSource' : experimentSource,
              'experimentType' : experimentType
        })
        });

        // If the response was "ok" then return the server's response
        if (response.ok) {
          return await response.json();
        } 
        // otherwise we log the error (visible under inspect element)
        else {
          console.error(`Attempt ${attempt} at updating homily count: Server responded with status ${response.status}`);
        }
      }
      // if the code fails due to some error, then...
      catch (error) {
        console.error(`Attempt ${attempt}: Failed to fetch from ${url} with error ${error}`);
      }
    }
    // final error thrown after we have exhausted the maximum number of retries
    throw new Error(`Failed to update homily count after ${maxRetries} attempts`);
    }


    // sends the user response to the server to be stored as a csv
    async function sendResults(header, data){

    // retrieve information about the user
    const userId = sessionStorage.getItem('userId');
    const userType = sessionStorage.getItem('userType');
    const experimentSource = sessionStorage.getItem('experimentSource');
    const experimentType = sessionStorage.getItem('experimentType');
    const filePath = sessionStorage.getItem('homilyId');

    // extract the homily number so we can create the file name of the questionnaire 
    // response file we store on the server

    // Split the string on the backslash
    const parts = filePath.split("\\");

    // Get the last element from the array
    const homilyName = parts[parts.length - 1];

    // Remove the '.mp3' part and get the number
    const homilyNumber = homilyName.replace(extension, "");

    // construct the filename for our questionnaire file
    const fileName = homilyNumber + '.csv';

    // url for the route that stores the questionnaire data
    const url = `/api/storeResponses`;

    // store the results in the given randomized question order
    let oldResults = {}
    for (let i = 0; i < header.length; i++){
      oldResults[String(header[i])] = String(data[i]);
    }

    // change the ordering so that the questions are de-randomized
    let results = {};
    saveOrder.forEach(questionName => {
      results[questionName] = oldResults[questionName];
    });

    // try sending sign in data to server, keep trying until we get an "ok" response (response code in the 200s range)
    const maxRetries = 3;
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {

        // AJAX request to the server to store consent info
        const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({
              'userId' : userId, 
              'userType' : userType,
              'experimentSource' : experimentSource,
              'experimentType' : experimentType,
              'fileName' : fileName,
              'results' : JSON.stringify(results)})
        });

        // If the response was "ok" then return the server's response
        if (response.ok) {
          return await response.json();
        } 
        // otherwise we log the error (visible under inspect element)
        else {
          console.error(`Attempt ${attempt} at saving homily questionnaire data: Server responded with status ${response.status}`);
        }
      }
      // if the code fails due to some error, then...
      catch (error) {
        console.error(`Attempt ${attempt}: Failed to fetch from ${url} with error ${error}`);
      }
    }
    // final error thrown after we have exhausted the maximum number of retries
    throw new Error(`Failed to save homily questionnaire data after ${maxRetries} attempts`);
    } 

    // sends the user response to the server to be stored as a csv
    async function sendOrder(header, order){

    // retrieve information about the user
    const userId = sessionStorage.getItem('userId');
    const userType = sessionStorage.getItem('userType');
    const experimentSource = sessionStorage.getItem('experimentSource');
    const experimentType = sessionStorage.getItem('experimentType');
    const filePath = sessionStorage.getItem('homilyId');

    // extract the homily number so we can create the file name of the questionnaire 
    // response file we store on the server

    // Split the string on the backslash
    const parts = filePath.split("\\");

    // Get the last element from the array
    const homilyName = parts[parts.length - 1];

    // Remove the '.mp3' part and get the number
    const homilyNumber = homilyName.replace(extension, "");

    // construct the filename for our questionnaire order file
    const fileName = homilyNumber + '_QuestionOrder.csv';

    // url for the route that stores the questionnaire order data
    const url = `/api/storeResponses`;

    // try sending sign in data to server, keep trying until we get an "ok" response (response code in the 200s range)
    const maxRetries = 3;
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {

        // AJAX request to the server to store consent info
        const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({
              'userId' : userId, 
              'userType' : userType,
              'experimentSource' : experimentSource,
              'experimentType' : experimentType,
              'fileName' : fileName,
              'results' : JSON.stringify(order)})
        });

        // If the response was "ok" then return the server's response
        if (response.ok) {
          return await response.json();
        } 
        // otherwise we log the error (visible under inspect element)
        else {
          console.error(`Attempt ${attempt} at saving questionnaire order data: Server responded with status ${response.status}`);
        }
      }
      // if the code fails due to some error, then...
      catch (error) {
        console.error(`Attempt ${attempt}: Failed to fetch from ${url} with error ${error}`);
      }
    }
    // final error thrown after we have exhausted the maximum number of retries
    throw new Error(`Failed to save questionnaire order data after ${maxRetries} attempts`);
    } 


    // checks if the the user has viewed all of the homilies for proper redirection
    async function checkHomiliesCompleted() {

    // retrieve information about the user
    const userId = sessionStorage.getItem('userId');
    const userType = sessionStorage.getItem('userType');
    const experimentSource = sessionStorage.getItem('experimentSource');
    const experimentType = sessionStorage.getItem('experimentType');

    // url for route that checks if all homilies have been completed
    const url = `/api/allHomiliesViewed/${userId}/${userType}/${experimentSource}/${experimentType}`;

    // maximum number of times we will try to contact the server
    const maxRetries = 3; 
    for (let attempt = 1; attempt <= maxRetries; attempt++) {

      // try contacting the server for info about user completion of homilies
      try {
      
        // get the server's response to our request
        const response = await fetch(url);
        
        // if the server's response is OK (200s range), then...
        if (response.ok) {

          // parse the response and extract the data regarding homily completion
          const parsedResponse = await response.json();
          const homiliesCompleted = await parsedResponse.allHomiliesCompleted;

          // return this information
          return homiliesCompleted;
        }
        // if the server's response is not ok, then log the error to the console
        else {
          console.error(`Attempt ${attempt} at checking if user has completed all homilies: Server responded with status ${response.status}`);
        }
      }
      // if the code fails due to some error, then...
      catch (error) {
          console.error(`Attempt ${attempt}: Failed to fetch from ${url} with error ${error}`);
      }
    }
    // final error thrown after we have exhausted the maximum number of retries
    throw new Error(`Failed to recover user's homily completion status after ${maxRetries} attempts`);
    }


    // gets the header for the soon-to-be csv file on the server
    function getHeader() {

    // variables to store names of checkboxes and textboxes
    var checkboxNames = [];
    var textboxNames = [];

    // extract the HTML checkboxes and textboxes
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const textboxes = document.querySelectorAll('textarea');

    // collect all check box names in order
    for (let checkbox of checkboxes) {

      // get the name of the question for the given checkbox
      let name = checkbox.name;

      // if the checkbox is checked, then add its name to the list of checkbox names
      if (checkbox.checked) {
        checkboxNames.push(name);
      }
    }

    // collect all textbox names
    for (let textbox of textboxes) {

      // collect the textbox's names
      let name = textbox.id;

      // add the textbox's name to the list of textbox names
      textboxNames.push(name);
    }

    // return one big list of checkbox names followed by textbox names
    return checkboxNames.concat(textboxNames);
    }


    // gets the header for the soon-to-be csv file on the server
    function getData() {

    // variables for storing checkbox responses and textbox responses
    let checkboxData = [];
    let textboxData = [];

    // collect the HTML checkboxes and textboxes
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    const textboxes = document.querySelectorAll('textarea');

    // collect all checkboxes of a given name into a list
    for (let checkbox of checkboxes) {

      // if the checkbox is checked, then add its value to the list of checkbox data
      if (checkbox.checked) {
        checkboxData.push(checkbox.value);
      }
    }

    // iterate over all textbox questions
    for (let textbox of textboxes) {

      // extract the user's text response to the question
      let textEntry = textbox.value;

      // add the user's response to the list of textbox data
      textboxData.push(textEntry);
    }

    return checkboxData.concat(textboxData); 
  }

    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------


    
    // ensures that the user has at most one checkbox selected at a time
    function uncheckOthers(groupName, currentCheckbox) {
      const checkboxes = document.querySelectorAll(`input[name="${groupName}"]`);
      checkboxes.forEach(checkbox => {
        if (checkbox !== currentCheckbox) {
          checkbox.checked = false;
        }})};

  </script>
</body>
</html>