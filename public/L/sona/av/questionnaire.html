<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homily Review</title>
  <style>
    body {
      font-family: 'Times New Roman', Times, serif;
      margin: 0;
      overflow: auto;
    }
    #background {
      font-family: 'Times New Roman', Times, serif;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color:#800000;
      z-index: -1;
    }
    .questionnaire-container {
      font-family: 'Times New Roman', Times, serif;
      display: none;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px;
      background-color: white;
      z-index: 1;
      }
      .redText {
        color: red
      }
      .blackText {
        color: black
      }
      h1{
        font-family: 'Times New Roman', Times, serif;
        text-align: center;
        text-decoration: underline;
      }
      button{
        font-family: 'Times New Roman', Times, serif;
        justify-content: center;
      }
      text{
        font-family: 'Times New Roman', Times, serif;
        color: red;
      }
  </style>
</head>
<body onload="showQuestionnaire()">
  <div id="background"></div>
  <div id="questionnaireContainer" class="questionnaire-container">
  </div>

  <script>

    sessionStorage.setItem('userType', 'laymen');
    sessionStorage.setItem('experimentSource', 'sona');
    sessionStorage.setItem('experimentType', 'av');


    // this block of code creates and displays the questionnaire
    // -----------------------------------------------------------------------------
    // -----------------------------------------------------------------------------
    // -----------------------------------------------------------------------------

    function showQuestionnaire() {
      const questionnaireContainer = document.getElementById('questionnaireContainer');
      questionnaireContainer.innerHTML = generateQuestionnaireHTML();

      // Display the questionnaire
      questionnaireContainer.style.display = 'block';
    }


    function generateQuestionnaireHTML() {
      // You can customize the questionnaire HTML generation based on your requirements
      return `
      <h1>Instructions </h1>
      <p>Please respond to the following questions about the homily you were just shown.
          You must respond to all of the required questions before submitting the form.
          Any unrequired question will be tagged as "optional". 
          Some questions will ask you to rate a particular feature of the homily on a scale from 1 to 6.
          Other questions will require a text entry with a minimum word count. 
          </p>
        
        <h1> Questions </h1>

        <!-- Compelling-ness -->
        <label for = "foundHomilyCompelling">
          <p>1. How compelling did you find this homily?</p>
        </label>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="1" onclick="uncheckOthers('foundHomilyCompelling', this)"> Not compelling (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="2" onclick="uncheckOthers('foundHomilyCompelling', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="3" onclick="uncheckOthers('foundHomilyCompelling', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="4" onclick="uncheckOthers('foundHomilyCompelling', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="5" onclick="uncheckOthers('foundHomilyCompelling', this)"> (5)
        </label> 
        <br>
        <label>
          <input type="checkbox" name="foundHomilyCompelling" value="6" onclick="uncheckOthers('foundHomilyCompelling', this)"> Very compelling (6)
        </label> 
        <br> <br>
        

        <!-- Understanding-->
        <label for = "understandingOfMessagePreached">
          <p>2. Did you understand the message being preached?</p>
        </label>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="1" onclick="uncheckOthers('understandingOfMessagePreached', this)"> Did not understand it (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="2" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="3" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="4" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="5" onclick="uncheckOthers('understandingOfMessagePreached', this)"> (5)
        </label> 
        <br>
        <label>
          <input type="checkbox" name="understandingOfMessagePreached" value="6" onclick="uncheckOthers('understandingOfMessagePreached', this)"> Understood it very well (6)
        </label> 
        <br> <br>

        
        <label for="messageMeaning"><p>3. What did you understand the message of the homily to be? (25 word minimum): </p></label>
        
        <textarea id="messageMeaning" name="messageMeaning" rows="4" cols="50"></textarea>
        <br> <br>

        <!-- Agreement-->
        <label for = "agreementWithHomilyMessage">
          <p>4. Do you agree with the homily's message?</p>
        </label>
        <label>
            <input type="checkbox" name="agreementWithHomilyMessage" value="1" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="2" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "agreementWithHomilyMessage" value="3" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="4" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="5" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="agreementWithHomilyMessage" value="6" onclick="uncheckOthers('agreementWithHomilyMessage', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Change in Thinking-->
        <label for = "DidHomilyChangeYourThinking">
          <p>5. Did the homily change your thinking about this message?</p>
        </label>
          <label>
            <input type="checkbox" name="DidHomilyChangeYourThinking" value="1" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="2" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DidHomilyChangeYourThinking" value="3" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="4" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="5" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourThinking" value="6" onclick="uncheckOthers('DidHomilyChangeYourThinking', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Accepting of the message
        <label for = "accepting">
          <p>6. Were you more or less accepting of the message being preached after watching the homily?</p>
        </label>
        <label>
            <input type="checkbox" name="accepting" value="Much less accepting" onclick="uncheckOthers('accepting', this)"> Much less accepting
        </label>
        <br>
        <label>
          <input type="checkbox" name="accepting" value="Somewhat less accepting" onclick="uncheckOthers('accepting', this)"> Somewhat less accepting
        </label>
        <br>
        <label>
          <input type="checkbox" name= "accepting" value="Just as accepting as I was before watching the homily" onclick="uncheckOthers('accepting', this)"> Just as accepting as I was before watching the homily
        </label>
        <br>
        <label>
          <input type="checkbox" name="accepting" value="Somewhat more accepting" onclick="uncheckOthers('accepting', this)"> Somewhat more accepting
        </label>
        <br>
        <label>
          <input type="checkbox" name="accepting" value="Much more accepting" onclick="uncheckOthers('accepting', this)"> Much more accepting
        </label> -->


        <!-- Change in Feelings -->
        <label for = "DidHomilyChangeYourFeelings">
          <p>6. Did the homily change your feelings in any way?</p>
        </label>
        <label>
            <input type="checkbox" name="DidHomilyChangeYourFeelings" value="1" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="2" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DidHomilyChangeYourFeelings" value="3" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="4" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="5" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DidHomilyChangeYourFeelings" value="6" onclick="uncheckOthers('DidHomilyChangeYourFeelings', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Direction of feeling change-->
        <label for = "DirectionOfHomilyFeelingChange">
          <p>7. Was the homily's effect on your feelings positive or negative?</p>
        </label>
        <label>
            <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="1" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> Negative (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="2" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "DirectionOfHomilyFeelingChange" value="3" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="4" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="5" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="DirectionOfHomilyFeelingChange" value="6" onclick="uncheckOthers('DirectionOfHomilyFeelingChange', this)"> Positive (6)
        </label>
        <br> <br>


        <!-- Engagement-->
        <label for = "engagedDuringHomily">
          <p>8. Did you feel engaged while listening the homily?</p>
        </label>
        <label>
            <input type="checkbox" name="engagedDuringHomily" value="1" onclick="uncheckOthers('engagedDuringHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="2" onclick="uncheckOthers('engagedDuringHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "engagedDuringHomily" value="3" onclick="uncheckOthers('engagedDuringHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="4" onclick="uncheckOthers('engagedDuringHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="5" onclick="uncheckOthers('engagedDuringHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="engagedDuringHomily" value="6" onclick="uncheckOthers('engagedDuringHomily', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Effectiveness -->
        <label for = "effectiveMessageCommunication">
          <p>9. Was the message effectively communicated?</p>
        </label>
        <label>
            <input type="checkbox" name="effectiveMessageCommunication" value="1" onclick="uncheckOthers('effectiveMessageCommunication', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="2" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name= "effectiveMessageCommunication" value="3" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="4" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="5" onclick="uncheckOthers('effectiveMessageCommunication', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="effectiveMessageCommunication" value="6" onclick="uncheckOthers('effectiveMessageCommunication', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Mental Picture
        <p>11. While you were listening to the homily, were you able to mentally picture aspects of what was being preached?</p>
        <label>
          <input type="checkbox" name="picturingEvents" value="Not at all" onclick="uncheckOthers('picturingEvents', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="picturingEvents" value="A little" onclick="uncheckOthers('picturingEvents', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="picturingEvents" value="Somewhat" onclick="uncheckOthers('picturingEvents', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="picturingEvents" value="A lot" onclick="uncheckOthers('picturingEvents', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="picturingEvents" value="Completely" onclick="uncheckOthers('picturingEvents', this)"> Completely
        </label>  -->

        <!-- activity in the room
        <p>12. While you were listening to the homily, was activity going on in the room around you on your mind? </p>
        <label>
          <input type="checkbox" name="extraneousActivity" value="Not at all" onclick="uncheckOthers('extraneousActivity', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="extraneousActivity" value="A little" onclick="uncheckOthers('extraneousActivity', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="extraneousActivity" value="Somewhat" onclick="uncheckOthers('extraneousActivity', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="extraneousActivity" value="A lot" onclick="uncheckOthers('extraneousActivity', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="extraneousActivity" value="Completely" onclick="uncheckOthers('extraneousActivity', this)"> Completely
        </label> -->

        <!-- Placing oneself in the scene
        <p>13. While you were listening to the homily, could you picture yourself in the scene of the events/narrative described in the homily? </p>
        <label>
          <input type="checkbox" name="mentallyPlacing" value="Not at all" onclick="uncheckOthers('mentallyPlacing', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentallyPlacing" value="A little" onclick="uncheckOthers('mentallyPlacing', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentallyPlacing" value="Somewhat" onclick="uncheckOthers('mentallyPlacing', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentallyPlacing" value="A lot" onclick="uncheckOthers('mentallyPlacing', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentallyPlacing" value="Completely" onclick="uncheckOthers('mentallyPlacing', this)"> Completely
        </label> -->

        <!-- Mental Involvement in the Homily
        <p>14. Were you mentally involved in the narrative while you were listening to it? </p>
        <label>
          <input type="checkbox" name="mentalInvolvement" value="Not at all" onclick="uncheckOthers('mentalInvolvement', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentalInvolvement" value="A little" onclick="uncheckOthers('mentalInvolvement', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentalInvolvement" value="Somewhat" onclick="uncheckOthers('mentalInvolvement', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentalInvolvement" value="A lot" onclick="uncheckOthers('mentalInvolvement', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="mentalInvolvement" value="Completely" onclick="uncheckOthers('mentalInvolvement', this)"> Completely
        </label> -->

        <!-- Persistence of Narrative
        <p>15. After finishing the homily, did you find it easy to put it out of your mind? </p>
        <label>
          <input type="checkbox" name="narrativePersistence" value="Not at all" onclick="uncheckOthers('narrativePersistence', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="narrativePersistence" value="A little" onclick="uncheckOthers('narrativePersistence', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="narrativePersistence" value="Somewhat" onclick="uncheckOthers('narrativePersistence', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="narrativePersistence" value="A lot" onclick="uncheckOthers('narrativePersistence', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="narrativePersistence" value="Completely" onclick="uncheckOthers('narrativePersistence', this)"> Completely
        </label> -->

        <!-- Excitement relating to the ending -->
        <label for = "AnticipationAboutEndingOfHomily">
          <p>10. As the homily progressed, did you find yourself interested in how the homily would end? </p>
        </label>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="1" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="2" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="3" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="4" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="5" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="AnticipationAboutEndingOfHomily" value="6" onclick="uncheckOthers('AnticipationAboutEndingOfHomily', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Emotional effect of the homily -->
        <label for = "emotionalEffectOfHomily">
          <p>11. Did the homily effect you emotionally? </p>
        </label>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="1" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="2" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="3" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="4" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="5" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="emotionalEffectOfHomily" value="6" onclick="uncheckOthers('emotionalEffectOfHomily', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- other outcomes
        <p>18. After listening to the homily did you find yourself thinking about how it could have turned out differently? </p>
        <label>
          <input type="checkbox" name="changeOfOutcome" value="Not at all" onclick="uncheckOthers('changeOfOutcome', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="changeOfOutcome" value="A little" onclick="uncheckOthers('changeOfOutcome', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="changeOfOutcome" value="Somewhat" onclick="uncheckOthers('changeOfOutcome', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="changeOfOutcome" value="A lot" onclick="uncheckOthers('changeOfOutcome', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="changeOfOutcome" value="Completely" onclick="uncheckOthers('changeOfOutcome', this)"> Completely
        </label> -->

        <!-- mind wandering -->
        <label for = "mindWanderingDuringHomily">
          <p>12. Did you find your mind wandering while listening to this homily? </p>
        </label>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="1" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="2" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="3" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="4" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="5" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="mindWanderingDuringHomily" value="6" onclick="uncheckOthers('mindWanderingDuringHomily', this)"> Yes (6)
        </label>
        <br> <br>


        <!-- Relevance of Homily to subject -->
        <label for="RelevanceToEverydayLife">
          <p>13. Did you find this homily relevant to your everyday life? </p>
        </label>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="1" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> No (1)
        </label>
        <br>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="2" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> (2)
        </label>
        <br>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="3" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> (3)
        </label>
        <br>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="4" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> (4)
        </label>
        <br>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="5" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> (5)
        </label>
        <br>
        <label>
          <input type="checkbox" name="RelevanceToEverydayLife" value="6" onclick="uncheckOthers('RelevanceToEverydayLife', this)"> Yes (6)
        </label>
        <br> <br>

        <!-- Life changing
        <label for="lifeChanging">
        <p>21. Did the message in this homily have a significant effect on your outlook on life? </p>
        <label>
        <label>
          <input type="checkbox" name="lifeChanging" value="Not at all" onclick="uncheckOthers('lifeChanging', this)"> Not at all
        </label>
        <br>
        <label>
          <input type="checkbox" name="lifeChanging" value="A little" onclick="uncheckOthers('lifeChanging', this)"> A little
        </label>
        <br>
        <label>
          <input type="checkbox" name="lifeChanging" value="Somewhat" onclick="uncheckOthers('lifeChanging', this)"> Somewhat
        </label>
        <br>
        <label>
          <input type="checkbox" name="lifeChanging" value="A lot" onclick="uncheckOthers('lifeChanging', this)"> A lot
        </label>
        <br>
        <label>
          <input type="checkbox" name="lifeChanging" value="Completely" onclick="uncheckOthers('lifeChanging', this)"> Completely
        </label> -->

        <br>
        <br>
        <label for="additionalComments">Additional Comments (optional):</label>
        <br>
        <textarea id="additionalComments" name="additionalComments" rows="4" cols="50"></textarea>

        
        <!-- Submit button -->
        <br> <br>
        <center>
          <text id = 'errorMessage'> </text>
        </center>
        <br>
        <center>
          <button onclick="submitForm()">Submit</button>
        </center>
        <br>
      `;
    }

    // -----------------------------------------------------------------------------
    // -----------------------------------------------------------------------------
    // -----------------------------------------------------------------------------



    // this block of code checks if user has completed the form and if so,
    // sends that data to the server to be stored as a csv file. 
    // If not, an error message is displayed.
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------

    // submits the form and send data if complete, otherwise gives error message
    function submitForm() {
      const isValid = validateForm();
      if (!isValid) {
        const errorMessage = document.getElementById('errorMessage');
        errorMessage.textContent = 'You must respond to all questions and meet all minimum required word counts';
        setTimeout(function() {
          errorMessage.textContent = '';
        }, 3000);
      }
      else{         
        // update viewed homilies on the server for that user and print server response
        updateViewedHomilies().then(response => {
          // get header and data and store as csv
          header = getHeader();
          data = getData();
          sendResults(header, data);
          updateHomilyCount();

          // check if expert has reviewed all homilies and redirect appropriately
          checkHomiliesCompleted().then(completed => {
          console.log(completed);
          if (!completed){
            window.location.href = 'new_homily_wait_screen.html';
          }
          else{
            window.location.href = 'religious_demographic.html';
          }
          });
        });
      }
    }


    // validates that the user answered all questions
    // (helper for submit form)
    function validateForm() {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      let valid = true;
      let name_dict = {};
      let unanswered = [];
      let answered = [];

      // check for required textboxes meeting minimum word count
      const responseHomilyMessage = document.getElementById("messageMeaning").value;
      if (wordCount(responseHomilyMessage) < 25){
        //console.log('messageMeaning');
        unanswered.push('messageMeaning');
        valid = false;
      } else {
        answered.push('messageMeaning');
      }

      // collect all checkboxes of a given name into a list
      for (let i = 0; i < checkboxes.length; i++){
        name = checkboxes[i].name;
        try {
          name_dict[name].push(checkboxes[i]);
        } catch (error){
          name_dict[name] = [checkboxes[i]];
        }}
        
      for (const [key, value] of Object.entries(name_dict)){
        let responded = false;
        for (let i = 0; i < value.length; i++){
          if (value[i].checked){
            responded = true;}}

          if (!responded){
            if (!unanswered.includes(key)) {
              //console.log(key);
              unanswered.push(key);
            }
            valid = false;
            //break;
          } else {
            if (!answered.includes(key)){
              //console.log(key);
            answered.push(key);
            }
          }
        }
      
      colorAnsweredAndUnanswered(answered, unanswered);
      //console.log('here');
      return valid;
    }

    // highlights unanswered questions in red and answered questions in black
    function colorAnsweredAndUnanswered(answered, unanswered) {
      
      // color all of the unanswered questions in red
      for (let i = 0; i < unanswered.length; i++) {
        if (unanswered[i] == 'messageMeaning') {
          console.log('here');
          let questionText = document.querySelector(`label[for="${unanswered[i]}"]`).querySelector('p');
          questionText.classList.remove('blackText');
          questionText.classList.add('redText');
          continue;
        } 
        console.log(unanswered[i])
        let checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${unanswered[i]}"]`);
        let questionText = document.querySelector(`label[for="${unanswered[i]}"]`).querySelector('p');
        questionText.classList.remove('blackText');
        questionText.classList.add('redText');
        for (j = 0; j < checkboxes.length; j++ ) {
          checkboxes[j].closest('label').classList.remove('blackText');
          checkboxes[j].closest('label').classList.add('redText');
        }
      }

      // color all of the answered questions in black
      console.log(answered.length)
      for (let i = 0; i < answered.length; i++) {
        if (answered[i] == 'messageMeaning') {
          console.log('here');
          let questionText = document.querySelector(`label[for="${answered[i]}"]`).querySelector('p');
          questionText.classList.remove('redText');
          questionText.classList.add('blackText');
          continue;
        } 
        let checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${answered[i]}"]`);
        let questionText = document.querySelector(`label[for="${answered[i]}"]`).querySelector('p');
        questionText.classList.remove('redText');
        questionText.classList.add('blackText');
        for (j = 0; j < checkboxes.length; j++ ) {
          checkboxes[j].closest('label').classList.remove('redText');
          checkboxes[j].closest('label').classList.add('blackText');
        }
      }
    }


    // returns the word count of a string
    // (helper for validate form)
    function wordCount(string){
      const words = string.split(" ");
      wordcount = 0;
      for (let i = 0; i < words.length; i++){
        if (!words[i] == ' ') {
          wordcount += 1;
        }
      }
      return wordcount;
    }
    
    // updates the total homily count on the server
    // helper for submitForm()
    async function updateHomilyCount() {
      const homilyId = sessionStorage.getItem('homilyId');
      const userType = sessionStorage.getItem('userType');
      const experimentSource = sessionStorage.getItem('experimentSource');
      const experimentType = sessionStorage.getItem('experimentType');
      const url = `/api/updateHomilyCount`;

      const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({'homilyId' : String(homilyId), 'userType': userType, 'experimentSource' : experimentSource, 'experimentType' : experimentType})
      });
      return await response.json();
    }


    // sends the user response to the server to be stored as a csv
    // (helper for submit form)
    async function sendResults(header, data){
      const userId = sessionStorage.getItem('userId');
      const userType = sessionStorage.getItem('userType');
      const homilyId = sessionStorage.getItem('homilyId');
      const experimentSource = sessionStorage.getItem('experimentSource');
      const experimentType = sessionStorage.getItem('experimentType');
      const url = `/api/storeQuestionnaireResults`;

      // package the results in an Object to later stringify
      let results = {}
      for (let i = 0; i < header.length; i++){
        results[String(header[i])] = String(data[i]);
      }

      const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({
              'userId' : userId, 
              'userType' : userType,
              'homilyId' : homilyId,
              'experimentSource' : experimentSource,
              'experimentType' : experimentType,
              'results' : JSON.stringify(results)})
        });
        return await response.json();
      } 


    // checks if the expert has viewed all of the homilies for proper redirection
    // (helper for submitForm)
    async function checkHomiliesCompleted(){
      const userId = sessionStorage.getItem('userId');
      const userType = sessionStorage.getItem('userType');
      const experimentSource = sessionStorage.getItem('experimentSource');
      const experimentType = sessionStorage.getItem('experimentType');
      
      const url = `/api/allHomiliesViewed/${userId}/${userType}/${experimentSource}/${experimentType}`;

      try{
        const response = await fetch(url);
        if (!response.ok){
              throw new Error('HTTP error! status: ${completed.status}');
          }
          const completed = await response.json()
          return await completed.done;
      } catch (error) {
          console.error("Unable to fetch completion data");
          return null;
        }
    }

    
    // update the list of homilies that the user has seen on the server 
    // (helper for "submitForm()")
    async function updateViewedHomilies(){
      const userId = sessionStorage.getItem('userId');
      const userType = sessionStorage.getItem('userType');
      const homilyId = sessionStorage.getItem('homilyId');
      const experimentSource = sessionStorage.getItem('experimentSource');
      const experimentType = sessionStorage.getItem('experimentType');

      console.log('session storage: ', userId, userType, homilyId)
      const url = '/api/updateViewedHomilies';

      const response = await fetch(url, {
        method: 'POST',
        headers: {'Content-Type' : 'application/json'},
        body: JSON.stringify({
              'userId' : userId, 
              'userType' : userType,
              'experimentSource' : experimentSource,
              'experimentType' : experimentType,
              'homilyId' : homilyId})
      });

      return await response.json();
    }


    // gets the header for the soon-to-be csv file on the server
    // (helper for "submitForm())
    function getHeader(){
      let homilyName = sessionStorage.getItem('homilyId');
      let checkboxNames = [];
      let textboxNames = [];
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const textboxes = document.querySelectorAll('textarea');

      // collect all check box names in order
      for (let i = 0; i < checkboxes.length; i++){
        name = checkboxes[i].name;
        if (checkboxNames.includes(name)){
          continue;
        }
        checkboxNames.push(name);
      }

      // collect all textbox names
      for (let i = 0; i < textboxes.length; i++){
        name = textboxes[i].id;
        textboxNames.push(name);
      }

      return checkboxNames.concat(textboxNames);
    }

    
    // gets the header for the soon-to-be csv file on the server
    // (helper for "submitForm())
    function getData(){
      let name_dict = {};
      let checkboxData = [];
      let textboxData = [];
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const textboxes = document.querySelectorAll('textarea');

      // collect all checkboxes of a given name into a list
      for (let i = 0; i < checkboxes.length; i++){
        name = checkboxes[i].name;
        try {
          name_dict[name].push(checkboxes[i]);
          } catch (error){
            name_dict[name] = [checkboxes[i]];}}
            
        // iterate over all checkbox questions
        for (const [key, value] of Object.entries(name_dict)){
          // iterate over each checkbox in a given question
          for (let i = 0; i < value.length; i++){
            let option = value[i];
            // add all values of checked checkboxes to the list
            if (option.checked){
              checkboxData.push(String(option.value));}}}

          // iterate over all textbox questions
          for (let i = 0; i < textboxes.length; i++){
            let textEntry = textboxes[i].value;
            textboxData.push(textEntry);}

      return checkboxData.concat(textboxData); 
    }

    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------
    // ---------------------------------------------------------------------


    
    // ensures that the user has at most one checkbox selected at a time
    function uncheckOthers(groupName, currentCheckbox) {
      const checkboxes = document.querySelectorAll(`input[name="${groupName}"]`);
      checkboxes.forEach(checkbox => {
        if (checkbox !== currentCheckbox) {
          checkbox.checked = false;
        }})};


    // prevents the user from navigating backwards through the experiment
    history.pushState(null, document.title, location.href);
    window.addEventListener('popstate', function (event) {
      history.pushState(null, document.title, location.href);});
  </script>
</body>
</html>